<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fjyt.asset.management.mapper.AssetBorrowMapper">

    <select id="borrowList" parameterType="BorrowQueryDTO" resultType="AssetBorrowVO">
        select
        ab.id,ab.borrow_code,ab.asset_codes,ab.borrow_user,ab.borrow_time,
        ab.borrow_start_time,ab.expected_return_time,ab.remark,ab.create_user,
        ab.create_time,ab.create_way,ab.update_user,ab.update_time,ab.status
        from asset_borrow ab
        <where>
            ab.borrow_del = '0'
            <if test="id != null">
                and ab.id = #{id}
            </if>
            <if test="borrowCode != null and borrowCode != ''">
                and ab.borrow_code like concat('%',#{borrowCode},'%')
            </if>
            <if test="borrowUser != null and borrowUser != ''">
                and ab.borrow_user like concat('%',#{borrowUser},'%')
            </if>
            <if test="status != null and status != ''">
                and ab.status = #{status}
            </if>
            <if test="beginBorrowStartTime != null and beginBorrowStartTime != ''">
                and date_format(ab.borrow_start_time,'%y%m%d') &gt;= date_format(#{beginBorrowStartTime},'%y%m%d')
            </if>
            <if test="endBorrowStartTime != null and endBorrowStartTime != ''">
                and date_format(ab.borrow_start_time,'%y%m%d') &lt;= date_format(#{endBorrowStartTime},'%y%m%d')
            </if>
            <if test="beginExpectedReturnTime != null and beginExpectedReturnTime != ''">
                and date_format(ab.expected_return_time,'%y%m%d') &gt;= date_format(#{beginExpectedReturnTime},'%y%m%d')
            </if>
            <if test="endExpectedReturnTime != null and endExpectedReturnTime != ''">
                and date_format(ab.expected_return_time,'%y%m%d') &lt;= date_format(#{endExpectedReturnTime},'%y%m%d')
            </if>
            <if test="beginCreateTime != null and beginCreateTime != ''">
                and date_format(ab.create_time,'%y%m%d') &gt;= date_format(#{beginCreateTime},'%y%m%d')
            </if>
            <if test="endCreateTime != null and endCreateTime != ''">
                and date_format(ab.create_time,'%y%m%d') &lt;= date_format(#{endCreateTime},'%y%m%d')
            </if>
        </where>
    </select>

    <select id="getBorrowById" parameterType="Long" resultType="BorrowDetailVO">
        select
        ab.id,ab.borrow_code,ab.asset_codes,ab.borrow_user,ab.borrow_time,
        ab.borrow_start_time,ab.expected_return_time,ab.remark,ab.status,
        ab.create_way,ab.create_user,ab.create_time
        from asset_borrow ab
        where ab.id = #{id}
    </select>

    <insert id="borrowAdd" parameterType="AssetBorrow">
        insert into asset_borrow
        (
         <if test="borrowCode != null and borrowCode != ''">borrow_code,</if>
        <if test="assetCodes != null and assetCodes != ''">asset_codes,</if>
        <if test="borrowUser != null and borrowUser != ''">borrow_user,</if>
        <if test="borrowTime != null">borrow_time,</if>
        <if test="borrowStartTime != null">borrow_start_time,</if>
        <if test="expectedReturnTime != null">expected_return_time,</if>
        <if test="remark != null and remark != ''">remark,</if>
        <if test="createUser != null and createUser != ''">create_user,</if>
        <if test="createTime != null">create_time,</if>
        <if test="createWay != null and createWay != ''">create_way,</if>
        <if test="updateUser != null and updateUser != ''">update_user,</if>
        <if test="status != null and status != ''">status,</if>
        update_time
        )
        values
        (
        <if test="borrowCode != null and borrowCode != ''">#{borrowCode},</if>
        <if test="assetCodes != null and assetCodes != ''">#{assetCodes},</if>
        <if test="borrowUser != null and borrowUser != ''">#{borrowUser},</if>
        <if test="borrowTime != null">#{borrowTime},</if>
        <if test="borrowStartTime != null">#{borrowStartTime},</if>
        <if test="expectedReturnTime != null">#{expectedReturnTime},</if>
        <if test="remark != null and remark != ''">#{remark},</if>
        <if test="createUser != null and createUser != ''">#{createUser},</if>
        <if test="createTime != null">#{createTime},</if>
        <if test="createWay != null and createWay != ''">#{createWay},</if>
        <if test="updateUser != null and updateUser != ''">#{updateUser},</if>
        <if test="status != null and status != ''">#{status},</if>
         #{updateTime}
        )
    </insert>

    <update id="borrowUpdate" parameterType="AssetBorrow">
        update asset_borrow
        <set>
            <if test="assetCodes != null and assetCodes != ''">asset_codes = #{assetCodes},</if>
            <if test="borrowUser != null and borrowUser != ''">borrow_user = #{borrowUser},</if>
            <if test="borrowTime != null">borrow_time = #{borrowTime},</if>
            <if test="borrowStartTime != null">borrow_start_time = #{borrowStartTime},</if>
            <if test="expectedReturnTime != null">expected_return_time = #{expectedReturnTime},</if>
            <if test="remark != null and remark != ''">remark = #{remark},</if>
            <if test="createWay != null and createWay != ''">create_way = #{createWay},</if>
            <if test="updateUser != null and updateUser != ''">update_user = #{updateUser},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            update_time = #{updateTime}
        </set>
        where id = #{id}
    </update>

    <update id="borrowDelete" parameterType="Long">
        update asset_borrow set borrow_del = '1' where id = #{id}
    </update>

    <update id="updateStatus">
        update asset_borrow set status = #{status} where borrow_code = #{borrowCode}
    </update>

    <select id="getCodes" parameterType="String" resultType="String">
        select asset_codes from asset_borrow
        where  borrow_code = #{borrowCode}
    </select>
</mapper>