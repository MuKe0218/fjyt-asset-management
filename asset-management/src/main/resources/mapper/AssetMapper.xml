<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fjyt.asset.management.mapper.AssetMapper">

   <select id="list" parameterType="AssetQueryDTO" resultType="AssetVO">
        select a.id,a.asset_code,a.asset_name,a.asset_specifications,
               a.asset_unit,a.asset_price,a.remark,a.create_user,a.create_time,
               a.create_way,a.update_user,a.update_time,a.status,ac.classify_name
        from asset a
        left join asset_classify ac on a.classify_id = ac.classify_id
        <where>
            a.asset_del = '0'
            <if test="id != null">
                and a.id = #{id}
            </if>
            <if test="assetCode != null and assetCode != ''">
                and a.ssset_code like concat('%',#{assetCode},'%')
            </if>
            <if test="assetName != null and assetName != ''">
                and a.asset_name like concat('%',#{assetName},'%')
            </if>
            <if test="classifyId != null">
                and a.classify_id = #{classifyId}
            </if>
            <if test="beginCreateTime != null and beginCreateTime != ''">
                and date_format(a.create_time,'%y%m%d') &gt;= date_format(#{beginCreateTime},'%y%m%d')
            </if>
            <if test="endCreateTime != null and endCreateTime != ''">
                and date_format(a.create_time,'%y%m%d') &lt;= date_format(#{endCreateTime},'%y%m%d')
            </if>
            <if test="beginUpdateTime != null and beginUpdateTime != ''">
                and date_format(a.update_time,'%y%m%d') &gt;= date_format(#{beginUpdateTime},'%y%m%d')
            </if>
            <if test="endUpdateTime != null and endUpdateTime != ''">
                and date_format(a.update_time,'%y%m%d') &lt;= date_format(#{endUpdateTime},'%y%m%d')
            </if>
            <if test="createWay != null">
                and a.create_way = #{createWay}
            </if>
            <if test="status != null">
                and a.status = #{status}
            </if>
        </where>
        order by a.update_time desc,a.create_time desc
   </select>

    <select id="assetById" parameterType="Long" resultType="AssetDetailVO">
        select a.id,a.asset_code,a.asset_name,a.classify_id,ac.classify_name,a.status,a.asset_specifications,
        a.asset_unit,a.asset_price,a.remark,a.create_way,a.create_user,a.create_time
        from asset a
        left join asset_classify ac on a.classify_id = ac.classify_id
        where
            a.asset_del = '0'
            and a.id = #{id}
    </select>

    <select id="getAssetPicturePath" parameterType="String" resultType="String">
        select picture_path from asset_picture where asset_code = #{assetCode}
    </select>

    <select id="getAssetNameList" parameterType="List" resultType="String">
        select asset_name from asset where id
        <foreach collection="strings" index="index" item="item" open="(" separator="," close=")">
        #{item}
        </foreach>
    </select>

    <select id="getAssetByCodes" parameterType="List" resultType="AssetVO">
        select a.asset_code,a.asset_name,a.asset_specifications,ac.ac.classify_name
               from asset a
                left join asset_classify ac on a.classify_id = ac.classify_id
        where a.id
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <insert id="add" parameterType="Asset">
        insert into asset(
            <if test="assetCode != null and assetCode != ''">asset_code,</if>
            <if test="assetName != null and assetName != ''">asset_name,</if>
            <if test="assetSpecifications !=null and assetSpecifications != ''">asset_specifications,</if>
            <if test="assetUnit != null and assetUnit != ''">asset_unit,</if>
            <if test="classifyId != null">classify_id,</if>
            <if test="assetPrice != null">asset_price,</if>
            <if test="remark != null and remark != ''">remark,</if>
            <if test="createUser != null and createUser != ''">create_user,</if>
            <if test="createWay != null">create_way,</if>
            <if test="updateUser != null and updateUser != ''">update_user,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="status != null">status,</if>
            <if test="assetDel != null">asset_del,</if>
            create_time
        )values (
            <if test="assetCode != null and assetCode != ''">#{assetCode},</if>
            <if test="assetName != null and assetName != ''">#{assetName},</if>
            <if test="assetSpecifications !=null and assetSpecifications != ''">#{assetSpecifications},</if>
            <if test="assetUnit != null and assetUnit != ''">#{assetUnit},</if>
            <if test="classifyId != null">#{classifyId},</if>
            <if test="assetPrice != null">#{assetPrice},</if>
            <if test="remark != null and remark != ''">#{remark},</if>
            <if test="createUser != null and createUser != ''">#{createUser},</if>
            <if test="createWay != null">#{createWay},</if>
            <if test="updateUser != null and updateUser != ''">#{updateUser},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="status != null">#{status},</if>
            <if test="assetDel != null">#{assetDel},</if>
            #{createTime}
        )
    </insert>

    <insert id="saveAssetPicturePath" parameterType="AssetPicture">
        insert into asset_picture(asset_code,picture_path)values(#{assetCode},#{picturePath})
    </insert>

    <update id="update" parameterType="Asset">
        update asset
        <set>
            <if test="assetName != null and assetName != ''">asset_name = #{assetName},</if>
            <if test="status != null and status != ''">status = #{status},</if>
            <if test="assetSpecifications !=null and assetSpecifications != ''">asset_specifications = #{assetSpecifications},</if>
            <if test="assetUnit != null and assetUnit != ''">asset_unit = #{assetUnit},</if>
            <if test="classifyId != null">classify_id = #{classifyId},</if>
            <if test="assetPrice != null">asset_price = #{assetPrice},</if>
            <if test="remark != null and remark != ''">remark = #{remark},</if>
            <if test="updateUser != null and updateUser != ''">update_user = #{updateUser},</if>
            update_time = #{updateTime}
        </set>
        where id = #{id}
    </update>

    <update id="updateStatusList" parameterType="UpdateStatus">
        <foreach collection="updateStatus.collect" item="item" separator=",">
            update asset set status = #{updateStatus.status} where asset_code = #{item}
        </foreach>
    </update>

    <update id="delete" parameterType="Long">
        update asset set asset_del = '1' where id = #{id}
    </update>

    <delete id="delAssetPicturePath" parameterType="String">
        delete from asset_picture where asset_code = #{assetCode}
    </delete>
</mapper>